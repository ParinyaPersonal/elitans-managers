<div class="grid gap-4 p-3">
    <div class="grid gap-4">
        <p class="text-zinc-700">You can choose the project you wish to proceed with by selecting from the list below. The project you select will be used in the next steps of the process. Be sure to choose the correct project to ensure the process proceeds accurately.</p>
        <div class="grid md:grid-cols-4 gap-3">
            <button onclick="location.href = '/behavior/manage';" class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50">Default</button>
            <button onclick="location.href = '/behavior/manage/obfuscate';" class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50">Obfuscated</button>
            <button onclick="location.href = '/behavior/manage/typescript';" class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50">TypeScript</button>
            <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="update">Update Version</button>
        </div>
    </div>
    <% if (path === '/behavior/manage') {%>
    <div class="grid gap-2">
        <label for="name"><a class="text-red-500 me-2">*</a>Select Project</label>
        <div class="grid md:grid-cols-2 gap-3">
            <div class="w-full flex-wrap gap-2 border divide-y divide-zinc-300 border-zinc-300 bg-zinc-50 overflow-auto max-h-[13rem]" id="project-list">
                <div class="w-full" id="project-null">
                    <input type="radio" name="option" id="null" value="" class="peer hidden" checked />
                    <label for="null" class="block cursor-pointer select-none peer-checked:bg-zinc-200 px-3 py-1 text-zinc-400 border-zinc-300">(No Project)</label>
                </div>
            </div>
            <div>
                <div class="grid grid-cols-2 gap-3">
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="copy" is="run">Copy Location</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="open" is="run">Open VSCode</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="zip" is="run">Zip Project</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="mcpack" is="run">McPack Project</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="encode" is="run">Encode Project</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="delete" is="run">Delete Project</button>
                </div>
            </div>
        </div>
    </div>
    <% } %>
    <% if (path === '/behavior/manage/obfuscate') {%>
    <div class="grid gap-2" id="show-obf">
        <label for="name"><a class="text-red-500 me-2">*</a>Select Project (Obfuscated)</label>
        <div class="grid md:grid-cols-2 gap-3">
            <div class="w-full flex-wrap gap-2 border divide-y divide-zinc-300 border-zinc-300 bg-zinc-50 overflow-auto max-h-[13rem]" id="project-obf">
                <div class="w-full" id="project-null">
                    <input type="radio" name="option" id="null" value="" class="peer hidden" checked />
                    <label for="null" class="block cursor-pointer select-none peer-checked:bg-zinc-200 px-3 py-1 text-zinc-400 border-zinc-300">(No Project)</label>
                </div>
            </div>
            <div>
                <div class="grid grid-cols-2 gap-3">
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="copy" is="run">Copy Location</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="zip" is="run">Zip Project</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="mcpack" is="run">McPack Project</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="delete" is="run">Delete Project</button>
                </div>
            </div>
        </div>
    </div>
    <% } %>
    <% if (path === '/behavior/manage/typescript') {%>
    <div class="grid gap-2">
        <label for="name"><a class="text-red-500 me-2">*</a>Select Project (TypeScript)</label>
        <div class="grid md:grid-cols-2 gap-3">
            <div class="w-full flex-wrap gap-2 border divide-y divide-zinc-300 border-zinc-300 bg-zinc-50 overflow-auto max-h-[13rem]" id="project-ts">
                <div class="w-full" id="project-null">
                    <input type="radio" name="option" id="null" value="" class="peer hidden" checked />
                    <label for="null" class="block cursor-pointer select-none peer-checked:bg-zinc-200 px-3 py-1 text-zinc-400 border-zinc-300">(No Project)</label>
                </div>
            </div>
            <div>
                <div class="grid grid-cols-2 gap-3">
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="copy" is="run">Copy Location</button>
                    <button class="w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="open" is="run">Open VSCode</button>
                    <button class="col-span-2 w-full bg-zinc-50 hover:bg-zinc-200 border border-zinc-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-sm px-5 py-2.5 text-center transition duration-200 cursor-pointer disabled:cursor-not-allowed disabled:opacity-50" id="delete" is="run">Delete Project</button>
                </div>
            </div>
        </div>
    </div>
    <% } %>
</div>
<script>
    $(document).ready(async function() {
        $('[is="run"]').prop("disabled", true)

        await $.ajax({
            url: '/folder',
            type: 'POST',
            "headers": {
                "Content-Type": "application/json"
            },
            "data": JSON.stringify({
                "base": localStorage.getItem("base"),
                "dir": "development_behavior_packs"
            }),
            success: function(data) {
                function create(v, d) {
                    const c = v.replaceAll(" ", "_")
                    $(`#project-${d}`).append(`<div class="w-full" id="project-${c}"></div>`)
                    $(`#project-${c}`).append(`<input type="radio" name="option" id="${v}" value="${v}" class="peer hidden" />`)
                    $(`#project-${c}`).append(`<label for="${v}" class="block cursor-pointer select-none peer-checked:bg-zinc-200 px-3 py-1 border-zinc-300"><a class="text-zinc-300 me-2">⁝⁝</a>${v}</label>`)
                }

                if ($("#project-obf"))
                    data
                    .filter(v => v.endsWith("obf"))
                    .forEach((v) => create(v, "obf"))
                if ($("#project-ts"))
                    data
                    .filter(v => v.endsWith("ts"))
                    .forEach((v) => create(v, "ts"))
                if ($("#project-list"))
                    data
                    .filter(v => !v.endsWith("obf") && !v.endsWith("ts"))
                    .forEach((v) => create(v, "list"))
            }
        });

        $("[name='option']").on("change", function() {
            const project = $(this).val()
            if (project == "") {
                $('[is="run"]').prop("disabled", true)
                $('#view-icon').attr('src', "https://www.lavalamp.com/wp-content/uploads/2016/07/placeholder-1-1.png")
            } else {
                $('[is="run"]').prop("disabled", false)
                $.ajax({
                    url: '/icon',
                    type: 'POST',
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                        "base": localStorage.getItem("base"),
                        "dir": "development_behavior_packs",
                        "folder": project.replace(" - ts", "")
                    }),
                    xhrFields: {
                        responseType: "blob"
                    },
                    success: function(data) {
                        const blob = new Blob([data], {
                            type: 'image/png'
                        });
                        $('#view-icon').attr("src", URL.createObjectURL(blob))
                    }
                })
            }
        })

        $("#copy").on("click", function() {
            if ($("[name='option']:checked").val() == "")
                return;
            navigator.clipboard.writeText(`${localStorage.getItem("base")}/development_behavior_packs/${$("[name='option']:checked").val()}`)
            Swal.fire({
                icon: "success",
                title: "Success",
                text: "Copy Success",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            })
            return false;
        })

        $("#open").on("click", function() {
            if ($("[name='option']:checked").val() == "")
                return;
            window.open(`vscode://file/${localStorage.getItem("base")}/development_behavior_packs/${$("[name='option']:checked").val()}`)
            return false;
        })

        function compile(type) {
            $.ajax({
                "url": "/compile",
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json"
                },
                "data": JSON.stringify({
                    "type": type,
                    "base": localStorage.getItem("base"),
                    "dir": "development_behavior_packs",
                    "folder": $("[name='option']:checked").val()
                }),
                success: function(data) {
                    Swal.fire({
                        icon: "success",
                        title: "Success",
                        text: "Compile Success",
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    })
                }
            })
        }

        $("#zip").on("click", function() {
            if ($("[name='option']:checked").val() == "")
                return;
            compile("zip")
            return false;
        })

        $("#mcpack").on("click", function() {
            if ($("[name='option']:checked").val() == "")
                return;
            compile("mcpack")
            return false;
        })

        $("#encode").on("click", function() {
            if ($("[name='option']:checked").val() == "")
                return;
            $.ajax({
                "url": "/behavior/encode",
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json"
                },
                "data": JSON.stringify({
                    "base": localStorage.getItem("base"),
                    "folder": $("[name='option']:checked").val()
                }),
                success: function(data) {
                    Swal.fire({
                        icon: "success",
                        title: "Success",
                        text: "Encode Success",
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    })
                    location.reload()
                },
                error: function(data) {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: `Encode Failed: ${data.responseText}`,
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    })
                }
            })
            return false;
        })

        $("#delete").on("click", async function() {
            if ($("[name='option']:checked").val() == "")
                return;
            const {
                isConfirmed
            } = await Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            })
            if (isConfirmed) {
                $.ajax({
                    "url": "/delete",
                    "method": "POST",
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                        "base": localStorage.getItem("base"),
                        "dir": "development_behavior_packs",
                        "folder": $("[name='option']:checked").val()
                    }),
                    success: async function(data) {
                        await Swal.fire({
                            icon: "success",
                            title: "Success",
                            text: "Delete Success",
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true
                        })
                        location.reload()
                    }
                })
            }
        })

        $("#update").on("click", function() {
            Swal.fire({
                title: 'Updating information',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading()
                }
            })
            $.ajax({
                "url": "/behavior/update",
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json"
                },
                "data": JSON.stringify({
                    "base": localStorage.getItem("base"),
                }),
                success: function(data) {
                    Swal.close();
                    Swal.fire({
                        icon: "success",
                        title: "Success",
                        text: "Update Success",
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    })
                },
                error: function(data) {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: `Update Failed: ${data.responseText}`,
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    })
                }
            })
        })
    })
</script>